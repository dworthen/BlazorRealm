<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Blazor Realm | Blazor Realm </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Blazor Realm | Blazor Realm ">
    <meta name="generator" content="docfx 2.36.2.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container-fluid">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                  Realm
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container-fluid hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container-fluid body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="blazor-realm">Blazor Realm</h1>

<p>Redux state management for <a href="https://blazor.net">blazor.net</a>.</p>
<blockquote><p><strong>NOTE FROM BLAZOR</strong></p>
<p>Blazor is an unsupported experimental web framework that shouldn&#39;t be used for production workloads at this time.</p>
</blockquote>
<ul>
<li><a href="#blazor-realm">Blazor Realm</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#application-state">Application State</a></li>
<li><a href="#actions">Actions</a></li>
<li><a href="#reducer">Reducer</a></li>
<li><a href="#register-the-app-store-as-a-service">Register the App Store as a Service</a></li>
<li><a href="#blazor-components">Blazor Components</a><ul>
<li><a href="#component-pattern-boilerplate">Component Pattern (boilerplate)</a></li>
</ul>
</li>
<li><a href="#middleware">Middleware</a><ul>
<li><a href="#middleware-as-extension-methods">Middleware as Extension Methods</a></li>
</ul>
</li>
<li><a href="#async-actions">Async Actions</a><ul>
<li><a href="#adding-async-middleware">Adding Async Middleware</a></li>
<li><a href="#dispatching-async-actions">Dispatching Async Actions</a></li>
</ul>
</li>
<li><a href="#redux-dev-tools">Redux Dev Tools</a><ul>
<li><a href="#ignoring-specific-actions-in-redux-dev-tools">Ignoring Specific Actions in Redux Dev Tools</a></li>
</ul>
</li>
</ul>
<h1 id="getting-started">Getting Started</h1>
<ol>
<li>For getting started with Blazor, visit <a href="https://blazor.net/../get-started.html">https://blazor.net/../get-started.html</a>.</li>
<li>Install <a href="https://www.nuget.org/packages/Blazor.Realm/">https://www.nuget.org/packages/Blazor.Realm/</a>.</li>
</ol>
<blockquote><p><strong>NOTE</strong></p>
<p>Blazor Realm is compatible with Blazor 0.4.0.</p>
</blockquote>
<h1 id="application-state">Application State</h1>
<pre><code class="lang-C#">// AppState.cs
public class AppState
{
    public int Count { get; set; }
    public IEnumerable&lt;WeatherForecast&gt; WeatherForecasts { get; set; } = new WeatherForecast[] { };
}
</code></pre><h1 id="actions">Actions</h1>
<pre><code class="lang-C#">//Actions.cs

// Counter Actions
public class IncrementByOne : IRealmAction { }

public class IncrementByValue : IRealmAction
{
    public int Value { get; set; }
    public IncrementByValue(int value)
    {
        Value = value;
    }
}

public class DecrementByOne : IRealmAction { }

public class DecrementByValue : IRealmAction
{
    public int Value { get; set; }
    public DecrementByValue(int value)
    {
        Value = value;
    }
}

public class ResetCount : IRealmAction { }

// WeatherForecasts Actions
public class ClearWeatherForecasts : IRealmAction { }

public class SetWeatherForecasts : IRealmAction
{
    public IEnumerable&lt;WeatherForecast&gt; WeatherForecasts { get; set; }
    public SetWeatherForecasts(IEnumerable&lt;WeatherForecast&gt; forecasts)
    {
        WeatherForecasts = forecasts;
    }
}
</code></pre><p>Actions must implement <code>IRealmAction</code>. Don&#39;t forget to add <code>using Blazor.Realm;</code>.</p>
<h1 id="reducer">Reducer</h1>
<pre><code class="lang-C#">// Reducer.cs

public static class Reducers
{
    public static AppState RootReducer(AppState appState, IRealmAction action)
    {
        if(appState == null)
        {
            throw new ArgumentNullException(nameof(appState));
        }

        // Return a new AppState
        return new AppState
        {
            // Composing Reducers for components
            Count = CounterReducer(appState.Count, action),
            WeatherForecasts = WeatherForecastsReducer(appState.WeatherForecasts, action)
        };
    }

    public static int CounterReducer(int count, IRealmAction action)
    {
        switch(action)
        {
            case IncrementByOne _:
                return count + 1;
            case IncrementByValue a:
                return count + a.Value;
            case DecrementByOne _:
                return count - 1;
            case DecrementByValue a:
                return count - a.Value;
            case ResetCount _:
                return 0;
            default:
                return count;
        }
    }

    public static IEnumerable&lt;WeatherForecast&gt;
    WeatherForecastsReducer(IEnumerable&lt;WeatherForecast&gt; forecasts, IRealmAction action)
    {
        switch(action)
        {
            case ClearWeatherForecasts _:
                return new WeatherForecast[] { };
            case SetWeatherForecasts a:
                return a.WeatherForecasts;
            default:
                return forecasts;
        }
    }

}
</code></pre><p>Don&#39;t forget to add <code>using Blazor.Realm;</code>.</p>
<h1 id="register-the-app-store-as-a-service">Register the App Store as a Service</h1>
<pre><code class="lang-C#">static void Main(string[] args)
{
    var serviceProvider = new BrowserServiceProvider(services =&gt;
    {
        // Add any custom services here
        services.AddRealmStore&lt;AppState&gt;(new AppState(), RootReducer);
    });

    new BrowserRenderer(serviceProvider).AddComponent&lt;App&gt;(&quot;app&quot;);
}
</code></pre><p>Don&#39;t forget to add <code>using Blazor.Realm;</code>.</p>
<h1 id="blazor-components">Blazor Components</h1>
<p>Don&#39;t forget to add <code>using Blazor.Realm;</code> to each component. Alternatively, add <code>using Blazor.Realm;</code>
to <em>_ViewImports.cshtml</em></p>
<pre><code class="lang-C#">@page &quot;/counter&quot;
@inject Store&lt;AppState&gt; store
@implements IDisposable

@* Or add to _ViewImports.cshtml *@
@using Blazor.Realm;

&lt;h1&gt;Counter&lt;/h1&gt;

&lt;p&gt;Current count: @State.Count&lt;/p&gt;

Change By: &lt;input type=&quot;text&quot; name=&quot;IncementAmount&quot; bind=&quot;@ChangeAmount&quot; /&gt;&lt;br /&gt;

&lt;button class=&quot;btn btn-primary&quot; onclick=&quot;@IncrementCount&quot;&gt;Increment&lt;/button&gt;&lt;br /&gt;
&lt;button class=&quot;btn btn-primary&quot; onclick=&quot;@DecrementCount&quot;&gt;Decrement&lt;/button&gt;&lt;br /&gt;


@functions {
    private int ChangeAmount { get; set; } = 1;

    // Handlers for Store and State from injected services
    private Store&lt;AppState&gt; Store =&gt; store;
    private AppState State;

    void IncrementCount()
    {
        Store.Dispatch(new IncrementByValue(ChangeAmount));
    }

    void DecrementCount()
    {
        Store.Dispatch(new DecrementByValue(ChangeAmount));
    }

    protected override void OnInit()
    {
        // Retrieve State from the store
        // Store.GetState returns a clone of State
        // as long as State is serializable.
        // This makes it ok to bind to @State in local
        // components as it will not mutate central state.
        // Only dispatching actions will update central state.
        State = Store.GetState();
        // Register handler for Realm Store Change event
        Store.Change += OnChangeHandler;
    }

    protected void OnChangeHandler(object sender, EventArgs e)
    {
        // Retreive new state on changes
        // and inform Blazor that state has changed 
        // for rerender.
        State = Store.GetState();
        StateHasChanged();
    }

    public virtual void Dispose()
    {
        // Remove event handlers when component is disposed
        Store.Change -= OnChangeHandler;
    }
}
</code></pre><h2 id="component-pattern-boilerplate">Component Pattern (boilerplate)</h2>
<ol>
<li>Inject <code>Store&lt;AppState&gt;</code>.</li>
<li>Store a local copy of state, <code>State = Store.GetState()</code>.</li>
<li>Register event handler for the change event in <code>OnInit</code> and Update local state.</li>
<li>Remove event handlers in <code>Dispose</code>.</li>
<li><code>Dispatch</code> actions and read state from <code>State</code>.</li>
</ol>
<p>The first 4 items are repeated in all components connecting to a Realm store. Instead of repeating this pattern, components may inherit from <code>Blazor.Realm.RealmComponent</code>.</p>
<pre><code class="lang-C#">@page &quot;/counter&quot;
@inherits RealmComponent&lt;AppState&gt;
@* Or add to _ViewImports.cshtml *@
@using Blazor.Realm;

&lt;h1&gt;Counter&lt;/h1&gt;

&lt;p&gt;Current count: @State.Count&lt;/p&gt;

Change By: &lt;input type=&quot;text&quot; name=&quot;IncementAmount&quot; bind=&quot;@ChangeAmount&quot;/&gt;&lt;br /&gt;

&lt;button class=&quot;btn btn-primary&quot; onclick=&quot;@IncrementCount&quot;&gt;Increment&lt;/button&gt;&lt;br /&gt;
&lt;button class=&quot;btn btn-primary&quot; onclick=&quot;@DecrementCount&quot;&gt;Decrement&lt;/button&gt;&lt;br /&gt;


@functions {
    private int ChangeAmount { get; set; } = 1;

    /**
    * Inheritiing from RealmComponent exposes Store, State and Dispatch.
    */

    void IncrementCount()
    {
        Dispatch(new IncrementByValue(ChangeAmount));
    }

    void DecrementCount()
    {
        Dispatch(new DecrementByValue(ChangeAmount));
    }

    // May still override OnInit, OnChangeHandler or Dispose
    // Just need to call the base method
    public override void Dispose()
    {
        base.Dispose();
        // Example of resetting local state when
        // app navigates away from page.
        Dispatch(new ResetCount());
    }
}
</code></pre><h1 id="middleware">Middleware</h1>
<pre><code class="lang-C#">// Program.cs

public class Program
{
    static void Main(string[] args)
    {
        var serviceProvider = new BrowserServiceProvider(services =&gt;
        {
            // Add any custom services here
            services.AddRealmStore&lt;AppState&gt;(new AppState(), RootReducer);
        });

        // using Microsoft.Extensions.DependencyInjection;
        IStoreBuilder&lt;AppState&gt; storeBuilder = 
            ServiceProvider.GetService&lt;IStoreBuilder&lt;AppState&gt;&gt;();

        storeBuilder.Use((Store&lt;AppState&gt; localStore, Dispatcher&lt;AppState&gt; next) =&gt;
        {
            return (IRealmAction action) =&gt;
            {
                /**
                * localStore = Store singleton. This allows one to dispatch
                * actions down the whole middleware pipeline. Example: error
                * handling middleware. Try passing actions down pipeline but if exception
                * is caught then dispatch a new ErrorAction down the pipeline for the
                * application to handle.
                *
                * next = next middleware in the pipeline.  next(action) will continue
                * sending the current action down the middleware pipeline.
                *
                * action = current action dispatched. 
                *
                * returns TState = Application State.
                */

                // Do stuff, like logging
                Console.WriteLine(&quot;Dispatching {0}&quot;, action.GetType().Name);
                Console.WriteLine(&quot;Old state: {0}&quot;,
                    JsonUtil.Serialize(localStore.State));

                // May also dispatch new actions.
                // This will send the action through the
                // whole middleware pipeline,
                // not just the next one in the pipeline.
                localStore.Dispatch(new SomeAction());

                // send current action to the next middleware
                AppState nextState = next(action);
                // do more stuff, like more logging
                Console.WriteLine(&quot;Action {0} complete.&quot;, action.GetType().Name);
                Console.WriteLine(&quot;New state: {0}&quot;,
                    JsonUtil.Serialize(nextState));

                return nextState;
            };
        });


        new BrowserRenderer(serviceProvider).AddComponent&lt;App&gt;(&quot;app&quot;);
    }
}
</code></pre><h2 id="middleware-as-extension-methods">Middleware as Extension Methods</h2>
<pre><code class="lang-C#">// Logger.cs
public class Logger&lt;TState&gt;
{
    private readonly Store&lt;TState&gt; _store;
    private readonly Dispatcher&lt;TState&gt; _next;

    public Logger(Store&lt;TState&gt; store, Dispatcher&lt;TSate&gt; next) 
    {
        _store = store;
        _next = next;
    }

    public TState Invoke(IRealmAction action)
    {
        // Logger implementation...
        return _next(action);
    }
}

// Extensions.cs
// Optional
public static class Extensions
{
    public static IStoreBuilder UseLogger&lt;TState&gt;(this IStoreBuilder&lt;TState&gt; builder)
    {
        return builder.UseMiddleware&lt;TState, Logger&lt;TState&gt;&gt;();
    }
}

// Program.cs

...

// using Microsoft.Extensions.DependencyInjection;
IStoreBuilder&lt;AppState&gt; storeBuilder = 
    ServiceProvider.GetService&lt;IStoreBuilder&lt;AppState&gt;&gt;();

storeBuilder.UseLogger&lt;AppState&gt;();
// Or without using an extension
// storeBuilder.UseMiddleware&lt;AppState, Logger&lt;AppState&gt;&gt;();

new BrowserRenderer(serviceProvider).AddComponent&lt;App&gt;(&quot;app&quot;);

...
</code></pre><h1 id="async-actions">Async Actions</h1>
<p>As with Redux, Async actions in Realm are handled by middleware. Download the <a href="https://www.nuget.org/packages/Blazor.Realm.Async/">Blazor.Realm.Async nuget package</a>.</p>
<p>Following a <a href="https://medium.freecodecamp.org/scaling-your-redux-app-with-ducks-6115955638be">ducks</a> organizational structure, I place async actions in a seperate <em>Operations.cs</em> file.</p>
<pre><code class="lang-C#">// Operations.cs

public class AsyncIncrementCounter : IAsyncRealmAction
{
    public Store&lt;AppState&gt; Store { get; set; }
    public int IncrementAmount { get; set; }
    public AsyncIncrementCounter(Store&lt;AppState&gt; store, int incrementAmount = 1)
    {
        Store = store ?? throw new ArgumentNullException(nameof(store));
        IncrementAmount = incrementAmount;
    }

    public async Task Invoke()
    {
        // Dispatch events to handle the start, middle
        // and end of async actions.
        // StartLoading and Endloading
        // are normal, sync actions defined in Actions.cs
        Store.Dispatch(new StartLoading());
        // Something async, like network call
        await Task.Delay(3000);
        // Call sync action to increment Counter
        Store.Dispatch(new IncrementByValue(IncrementAmount));
        Store.Dispatch(new EndLoading());
    }
}
</code></pre><p>Async actions must implement the <code>IAsyncRealmAction</code> interface and, in turn, implement <code>Task Invoke</code> method.</p>
<h2 id="adding-async-middleware">Adding Async Middleware</h2>
<pre><code class="lang-C#">// program.cs

var serviceProvider = new BrowserServiceProvider(services =&gt;
{
    // Add any custom services here
    services.AddRealmStore&lt;AppState&gt;(new AppState(), RootReducer);
});

// using Microsoft.Extensions.DependencyInjection;
IStoreBuilder&lt;AppState&gt; storeBuilder = 
    ServiceProvider.GetService&lt;IStoreBuilder&lt;AppState&gt;&gt;();

storeBuilder.UseRealmAsync&lt;AppState&gt;();

new BrowserRenderer(serviceProvider).AddComponent&lt;App&gt;(&quot;app&quot;);

</code></pre><h2 id="dispatching-async-actions">Dispatching Async Actions</h2>
<p>In <em>Counter.cshtml</em></p>
<pre><code class="lang-C#">@page &quot;/counter&quot;
@inherits RealmComponent&lt;AppState&gt;

...

&lt;button class=&quot;btn btn-primary&quot; onclick=&quot;@AsyncIncrement&quot;&gt;Async Increment&lt;/button&gt;&lt;br /&gt;

@functions {
    ...

    void AsyncIncrement() // this method is not really async
    {
        Dispatch(new AsyncIncrementAction(Store, ChangeAmount));
    }

    ...
}
</code></pre><h1 id="redux-dev-tools">Redux Dev Tools</h1>
<p><img src="../images/redux-devtools.GIF" alt="Redux DevTools"></p>
<p>Connecting to the <a href="http://extension.remotedev.io/">Redux DevTools</a> browser extension is handled by middleware.</p>
<p>Steps for connecting to Redux Dev Tools:</p>
<ol>
<li><a href="http://extension.remotedev.io/#installation">Install the browser extension</a>.</li>
<li>Install the middleware, <a href="https://www.nuget.org/packages/Blazor.Realm.ReduxDevTools/">https://www.nuget.org/packages/Blazor.Realm.ReduxDevTools/</a></li>
</ol>
<p>Using the middleware</p>
<pre><code class="lang-C#">// program.cs
var serviceProvider = new BrowserServiceProvider(services =&gt;
{
    // Add any custom services here
    services.AddRealmStore&lt;AppState&gt;(new AppState(), RootReducer);
});

// using Microsoft.Extensions.DependencyInjection;
IStoreBuilder&lt;AppState&gt; storeBuilder = 
    ServiceProvider.GetService&lt;IStoreBuilder&lt;AppState&gt;&gt;();

storeBuilder.UseRealmAsync&lt;AppState&gt;();

storeBuilder.UseRealmReduxDevTools&lt;AppState&gt;();

new BrowserRenderer(serviceProvider).AddComponent&lt;App&gt;(&quot;app&quot;);
</code></pre><blockquote><p><strong>NOTE</strong></p>
<p>The order in which middleware is registred matters. Add <code>UseRealmReduxDevTools</code> after <code>UseRealmAsync</code>.</p>
</blockquote>
<h2 id="ignoring-specific-actions-in-redux-dev-tools">Ignoring Specific Actions in Redux Dev Tools</h2>
<pre><code class="lang-C#">// program.cs

storeBuilder.UseRealmReduxDevTools&lt;AppState&gt;(new Type[] {
    // ResetCount actions will not show up in the Redux DevTools 
    // browser extension
    typeof(ResetCount)
});
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dworthen/BlazorRealm/blob/master/docs/docs/quickstart.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
